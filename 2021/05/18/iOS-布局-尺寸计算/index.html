














<!doctype html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge, chrome=1">
  <meta name="renderer" content="webkit">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, shrink-to-fit=no", user-scalable=no">
  <title>iOS 布局-尺寸计算Hello Skill</title>
  <link rel="shortcut icon" href="">
  
    
    
      <link rel="stylesheet" href="/web/css/bootstrap.min.css">
    
      <link rel="stylesheet" href="/web/css/font-awesome.min.css">
    
      <link rel="stylesheet" href="/web/css/atom-one-dark.css">
    
      <link rel="stylesheet" href="/web/css/jquery.fancybox.css">
    
      <link rel="stylesheet" href="/web/css/nprogress.min.css">
    
      <link rel="stylesheet" href="/web/css/valine.css">
    
      <link rel="stylesheet" href="/web/css/life.css">
    
  

  

  <!-- jQuery first, then Tether, then Bootstrap JS. -->
  
  
  
    <script src="/web/js/jquery-2.2.4.min.js"></script>
  
    <script src="https://cdn1.lncld.net/static/js/3.1.0/av-min.js"></script>
  
    <script src="/web/js/jquery.pjax.js"></script>
  
    <script src="/web/js/nprogress.min.js"></script>
  
    <script src="/web/js/tether.min.js"></script>
  
    <script src="/web/js/bootstrap.min.js"></script>
  
    <script src="/web/js/highlight.min.js"></script>
  
    <script src="/web/js/highlightjs-line-numbers.min.js"></script>
  
    <script src="/web/js/jquery.fancybox.js"></script>
  
    <script src="/web/js/jquery.qrcode.min.js"></script>
  
    <script src="/web/js/Valine.min.js"></script>
  
  
<meta name="generator" content="Hexo 4.2.1"></head>
<body>
<script>AV.init({appId:'',appKey:''});</script>
<script type="text/javascript">
      var config = {
            ClasS: 'Counter',
            el:'.views',
            elP: '.views-post'
      }
</script>
<div class="container">
    <div class="row blog-box-shadow">
        <!--博客主栏开始-->
        <div class="col-xl-9 col-lg-12 blog-main" id="pjax-box">
            <header class="blog-header">
                <a href="https://joriwang.github.io/web" class="blog-header-mobile-title">Hello Skill</a>
                <a href="javascript:;" class="blog-header-navbar-btn"><i class="fa fa-bars"></i></a>
                <nav class="blog-header-navbar blog-header-fixed">
                    <ul class="blog-navbar-links">
                        
                          <li class="blog-nav-item"><a href="/web" class="transition">首页</a></li>
                        
                          <li class="blog-nav-item"><a href="/about/" class="transition">关于</a></li>
                        
                        <div class="blog-navbar-right">
                            <form action="">
                                <div class="input-group">
                                    <input type="text" class="blog-header-search" placeholder="search...">
                                    <buttn type="submit" class="blog-header-search-btn"><i class="fa fa-search"></i></buttn>
                                </div>
                            </form>
                        </div>
                    </ul>
                </nav>
            </header>
                
<header class="blog-post-page-title">
    <h4>iOS 布局-尺寸计算</h4>
    <time datetime="2021-05-18T16:00:00.000Z"><i class="fa fa-clock-o"></i>2021-05-19</time>
    
    
    
    
	
        <span><i class="fa fa-folder-o"></i>
    		
    	       <a href="/web/categories/iOS/" rel="categories" data-toggle="tooltip" data-placement="top" title="Linux">iOS</a>
    		
        </span>
	
    
</header>
<div class="blog-main-post blog-post-page-box">
    <article class="blog-post-block blog-post-page-content">
        <section>
            
                <p>原味地址：<a href="https://zhangbuhuai.com/post/auto-layout-part-1.html" target="_blank" rel="noopener">https://zhangbuhuai.com/post/auto-layout-part-1.html</a></p>
<h1 id="iOS-布局机制"><a href="#iOS-布局机制" class="headerlink" title="iOS 布局机制"></a>iOS 布局机制</h1><p>iOS 布局机制大概分这么几个层次：</p>
<ul>
<li>frame layout</li>
<li>autoresizing</li>
<li>auto layout</li>
</ul>
<p><strong>Frame Layout</strong></p>
<p>frame layout 最简单直接，简单来说，即通过设置 view 的 frame 属性值进而控制 view 的位置（相对于 superview 的位置）和大小。</p>
<p><strong>Autoresizing</strong></p>
<p>autoresizing 和 frame layout 一样，从一开始存在，它算是后者的补充，基于 autoresizing 机制，能够让 subview 和 superview 维持一定的布局关系，譬如让 subview 的大小适应 superview 的大小，随着后者的改变而改变。</p>
<p>站在代码接口的角度来看，autoresizing 主要体现在几个属性上，包括（但不限于）：</p>
<p><code>translatesAutoresizingMaskIntoConstraints</code> 和 <code>autoresizingMask</code></p>
<p>第一个属性标识 view 是否愿意被 autoresize； 第二个属性是一个枚举值，决定了当 superview 的 size 改变时，subview 应该做出什么样的调整；</p>
<p>关于 autoresizing 的更详细使用说明，参考：<a href="http://www.cocoachina.com/articles/10652" target="_blank" rel="noopener">自动布局之 autoresizingMask 使用详解</a>。</p>
<p><strong>Auto Layout</strong></p>
<p>autoresizing 存在的不足是非常显著的，通过 autoresizingMask 的可选枚举值可以看出：基于 autoresizing 机制，我们只能让 view 在 superview 的大小改变时做些调整；而无法处理兄弟 view 之间的关系，譬如处理与兄弟 view 的间隔；更无法反向处理，譬如让 superview 依据 subview 的大小进行调整。</p>
<p>Auto Layout 是随着 iOS 6 推出来的，关于它的介绍，官方文档《Auto Layout Guide》的描述非常精炼：</p>
<blockquote>
<p>Auto Layout is a system that lets you lay out your app’s user interface by creating a mathematical description of the relationships between the elements. You define these relationships in terms of constraints either on individual elements, or between sets of elements. Using Auto Layout, you can create a dynamic and versatile interface that responds appropriately to changes in screen size, device orientation, and localization.</p>
</blockquote>
<p>简单来说，它是一种基于约束的布局系统，可以根据你在元素（对象）上设置的约束自动调整元素（对象）的位置和大小。</p>
<p>值得一提的是，<em>对于某个 view 的布局方式，autoresizing 和 auto layout 只能二选一</em>，简单来说，若要对某个 view 采用 auto layout 布局，则需要设置其 <code>translatesAutoresizingMaskIntoConstraints</code> 属性值为 <code>NO</code>。</p>
<h1 id="几个重要的-API"><a href="#几个重要的-API" class="headerlink" title="几个重要的 API"></a>几个重要的 API</h1><h2 id="intrinsicContentSize"><a href="#intrinsicContentSize" class="headerlink" title="intrinsicContentSize"></a>intrinsicContentSize</h2><p>在介绍 <code>intrinsicContentSize</code> 方法之前，先来看一个应用场景：</p>
<p>场景一：某个 UILabel 用于显示单行文本，让其能够自适应文本，即根据文本自动调整其大小。</p>
<p>让 UILabel 自适应文本，在 auto layout 之前，一般做法是先给定字体，进而计算文本内容所占据的宽度 width 和高度 height，然后使用得来的 width 和 height 设置其 frame 属性值。</p>
<p>但是使用 auto layout 非常简单，如下：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ViewController</span> () </span>&#123;</span><br><span class="line">    <span class="built_in">UILabel</span> *testLabel;</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">self</span>.view.backgroundColor = [<span class="built_in">UIColor</span> whiteColor];</span><br><span class="line">    </span><br><span class="line">    testLabel = (&#123;</span><br><span class="line">        <span class="built_in">UILabel</span> *label        = [[<span class="built_in">UILabel</span> alloc] init];</span><br><span class="line">        label.textAlignment   = <span class="built_in">NSTextAlignmentCenter</span>;</span><br><span class="line">        label.font            = [<span class="built_in">UIFont</span> systemFontOfSize:<span class="number">14.0</span>];</span><br><span class="line">        label.textColor       = [<span class="built_in">UIColor</span> whiteColor];</span><br><span class="line">        label.backgroundColor = [<span class="built_in">UIColor</span> lightGrayColor];</span><br><span class="line">        label;</span><br><span class="line">    &#125;);</span><br><span class="line">    [<span class="keyword">self</span>.view addSubview:testLabel];</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 使用Masonry添加constraints</span></span><br><span class="line">    [testLabel mas_makeConstraints:^(MASConstraintMaker *make) &#123;</span><br><span class="line">        make.top.equalTo(<span class="keyword">self</span>.view.mas_top).offset(<span class="number">40</span>);</span><br><span class="line">        make.left.equalTo(<span class="keyword">self</span>.view.mas_left).offset(<span class="number">10</span>);</span><br><span class="line">    &#125;];</span><br><span class="line">    testLabel.text = <span class="string">@"天地玄黄 宇宙洪荒 日月盈昃 辰宿列张"</span>;</span><br><span class="line">&#125;</span><br><span class="line">    </span><br><span class="line">- (<span class="keyword">void</span>)viewDidAppear:(<span class="built_in">BOOL</span>)animated &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidAppear:animated];</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"testLabel.origin = %@"</span>, <span class="built_in">NSStringFromCGPoint</span>(testLabel.frame.origin));</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"testLabel.size = %@"</span>, <span class="built_in">NSStringFromCGSize</span>(testLabel.frame.size));</span><br><span class="line">    <span class="comment">// print: "testLabel.origin = &#123;10, 40&#125;"</span></span><br><span class="line">    <span class="comment">// print: "testLabel.size = &#123;236.5, 17&#125;"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>效果如下：<br><img src="1.png" alt="1"></p>
<p>问题来了，auto layout system 知道 testLabel 的 size 呢？</p>
<p>OK，就此引入 API intrinsicContentSize。</p>
<p><code>intrinsicContentSize</code> 是 UIView 的基础方法（Available in iOS 6.0 and later），UIView Class References对它的描述如下：</p>
<blockquote>
<p>Returns the natural size for the receiving view, considering only properties of the view itself.   Return Value A size indicating the natural size for the receiving view based on its intrinsic properties.   Discussion Custom views typically have content that they display of which the layout system is unaware. Overriding this method allows a custom view to communicate to the layout system what size it would like to be based on its content. This intrinsic size must be independent of the content frame, because there’s no way to dynamically communicate a changed width to the layout system based on a changed height, for example. If a custom view has no intrinsic size for a given dimension, it can return UIViewNoIntrinsicMetric for that dimension.</p>
</blockquote>
<p><em>intrinsic content size</em> 在中文世界里常被译作：<em>固有内容大小</em>，简单来说，它被用来告诉 auto layout system 应该给它分配多大的 size。</p>
<p>所以呢，在上文代码（场景一的 Solution）中，根据我的理解，layout 工作流程是这样的：在 layout 时，auto layout system 会去回调 testLabel 的实例方法 intrinsicContentSize，该方法能够根据「文本内容+字体」计算出 content 的 size，进而根据此 size 对 testLabel 进行布局。</p>
<p>为了验证这个说法，对上述代码做些改变。</p>
<p>首先定义一个继承自 UILabel 的类 ZWLabel，重写 ZWLabel 的intrinsicContentSize方法，如下：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">ZWLabel</span> : <span class="title">UILabel</span></span></span><br><span class="line">    </span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line">    </span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">ZWLabel</span></span></span><br><span class="line">    </span><br><span class="line">- (<span class="built_in">CGSize</span>)intrinsicContentSize &#123;</span><br><span class="line">    <span class="built_in">CGSize</span> size = [<span class="keyword">super</span> intrinsicContentSize];</span><br><span class="line">    size.width  += <span class="number">20</span>;</span><br><span class="line">    size.height += <span class="number">20</span>;</span><br><span class="line">    <span class="keyword">return</span> size;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>

<p>然后让上文的 testLabel 从 UILabel 的实例改为 ZWLabel 的实例，其余不变：</p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">testLabel</span> = (&#123;</span><br><span class="line">    ZWLabel *label = [[ZWLabel alloc] init]<span class="comment">;</span></span><br><span class="line">    //...</span><br><span class="line">    label<span class="comment">;</span></span><br><span class="line">&#125;)<span class="comment">;</span></span><br></pre></td></tr></table></figure>

<p>效果如下：<br><img src="2.png" alt="2"></p>
<p>效果明显，本示例较为直观说明了 intrinsicContentSize 这个 API 的作用了，这个 API 是为 auto layout system 的 callback 提供的！</p>
<p>对于上文所用到的 UILabel，想必 Cocoa 在实现 intrinsicContentSize 方法时已经根据 text 属性值和 font属性值进行了计算。那是不是每个原生 view 都实现了intrinsicContentSize呢？</p>
<p>NO！《Auto Layout Guide》在谈论「intrinsic content size」时，总会与另外一个词语「leaf-level views」相关联，譬如：</p>
<blockquote>
<p>Intrinsic Content Size Leaf-level views such as buttons typically know more about what size they should be than does the code that is positioning them. This is communicated through the intrinsic content size, which tells the layout system that a view contains some content that it doesn’t natively understand, and indicates how large that content is, intrinsically.</p>
</blockquote>
<p>「leaf-level views」指的是那种一般不包含任何 subview 的 view，譬如 UILabel、UIButton 等，这类的 view 往往能够直接计算出 content（譬如 UILabel 的 text、UIButton 的 title，UIImageView 的 image）的大小。</p>
<p>但是有些 view 不包含 content，譬如 UIView，这种 view 被认为「has no intrinsic size」，它们的intrinsicContentSize 返回的值是 <strong>(-1,-1)</strong>。</p>
<p><em>官方文档中说的是：UIView’s default implementation is to return (UIViewNoIntrinsicMetric, UIViewNoIntrinsicMetric)，而 UIViewNoIntrinsicMetric 等于-1，为什么是-1而不是0，我猜是0是一个有效的 width/height，而-1不是，更容易区分处理。</em></p>
<p>还有一种 view 虽然包含 content，但是 intrinsicContentSize 返回值也是(-1,-1)，这类 view 往往是 UIScrollView 的子类，譬如 UITextView，它们是可滚动的，因此 auto layout system 在对这类 view 进行布局时总会存在一些未定因素，Cocoa 干脆让这些 view 的intrinsicContentSize返回(-1,-1)。</p>
<h2 id="preferredMaxLayoutWidth"><a href="#preferredMaxLayoutWidth" class="headerlink" title="preferredMaxLayoutWidth"></a>preferredMaxLayoutWidth</h2><p>基于上述场景一，我们来分析更复杂一点的 UILabel 自适应问题。</p>
<p>场景二：某个 UILabel 用于显示多行文本，让其能够自适应文本，即根据文本自动调整其大小；</p>
<p>对于单行文本 UILabel，UILabel 的 intrinsicContentSize 在计算 content size 时比较容易；但对于多行文本的 UILabel，同样的 content，譬如「天地玄黄宇宙洪荒」这八个字，摆放方式可以是 1x8，可以是 2x4，可以是 4x2，auto layout system 该如何处理呢？UILabel 的属性 <code>preferredMaxLayoutWidth</code> 正是用来应对这个问题的。</p>
<p>UILabel Class References对它的描述如下：</p>
<blockquote>
<p>The preferred maximum width (in points) for a multiline label.   Discussion This property affects the size of the label when layout constraints are applied to it. During layout, if the text extends beyond the width specified by this property, the additional text is flowed to one or more new lines, thereby increasing the height of the label.</p>
</blockquote>
<p><code>preferredMaxLayoutWidth</code> 的作用顾名思义，用来限制 UILabel content size 的最大宽度值。如下代码：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">testLabel = (&#123;</span><br><span class="line">    UILabel *<span class="keyword">label</span><span class="bash">                = [[UILabel alloc] init];</span></span><br><span class="line">    <span class="keyword">label</span>.<span class="bash">textAlignment           = NSTextAlignmentCenter;</span></span><br><span class="line">    <span class="keyword">label</span>.<span class="bash">font                    = [UIFont systemFontOfSize:14.0];</span></span><br><span class="line">    <span class="keyword">label</span>.<span class="bash">textColor               = [UIColor whiteColor];</span></span><br><span class="line">    <span class="keyword">label</span>.<span class="bash">numberOfLines           = 0;      // mark</span></span><br><span class="line">    <span class="keyword">label</span>.<span class="bash">preferredMaxLayoutWidth = 100;    // mark</span></span><br><span class="line">    <span class="keyword">label</span>.<span class="bash">backgroundColor         = [UIColor lightGrayColor];</span></span><br><span class="line">    <span class="keyword">label</span><span class="bash">;</span></span><br><span class="line">&#125;);</span><br><span class="line">[self.view addSubview:testLabel];</span><br><span class="line">    </span><br><span class="line">// 使用Masonry添加constraints</span><br><span class="line">[testLabel mas_makeConstraints:^(MASConstraintMaker *make) &#123;</span><br><span class="line">    make.top.equalTo(self.view.mas_top).offset(<span class="number">40</span>);</span><br><span class="line">    make.left.equalTo(self.view.mas_left).offset(<span class="number">10</span>);</span><br><span class="line">&#125;];</span><br><span class="line"> </span><br><span class="line">testLabel.text = @<span class="string">"天地玄黄 宇宙洪荒 日月盈昃 辰宿列张"</span>;</span><br></pre></td></tr></table></figure>

<p>效果如下：<br><img src="3.png" alt="3"></p>
<p>那么最后 testLabel 的 width 是不是就是 preferredMaxLayoutWidth 的属性值呢？No，最终 testLabel 的属性值小于等于preferredMaxLayoutWidth 的属性值。</p>
<h2 id="sizeThatFits-和-sizeToFit"><a href="#sizeThatFits-和-sizeToFit" class="headerlink" title="sizeThatFits: 和 sizeToFit"></a>sizeThatFits: 和 sizeToFit</h2><p>上文已经提到，UITextView 继承自 UIScrollView，是可以滚动的，它的 <code>intrinsicContentSize</code> 方法返回值是(-1,-1)，auto layout system 在处理 UITextView 对象时，为其设置的 size 是(0,0)。如此看来，似乎UITextView无法体验到 auto layout 带来的好处了。</p>
<p>继续结合应用场景引出 <code>sizeThatFits:</code> 方法和 <code>sizeToFit</code> 方法。</p>
<p>场景三：某个 UITextView 用于显示文本，让其能够自适应文本，即根据文本自动调整其大小；</p>
<p>既然 UITextView 的 content 计算方法 intrinsicContentSize 无法向 auto layout system 传递我们想要传达的值，我们就应该另想别的方法。</p>
<p>先谈 sizeThatFits: 方法，UIView Class References对它的描述如下：</p>
<blockquote>
<p>Asks the view to calculate and return the size that best fits the specified size.   Return Value A new size that fits the receiver’s subviews.   Discussion The default implementation of this method returns the existing size of the view. Subclasses can override this method to return a custom value based on the desired layout of any subviews. For example, a UISwitch object returns a fixed size value that represents the standard size of a switch view, and a UIImageView object returns the size of the image it is currently displaying.</p>
</blockquote>
<p>简单来说，调用 <code>sizeThatFits:</code> 方法意味着「根据文本计算最适合 UITextView 的 size」。从功能来讲，<code>sizeThatFits:</code> 和 <code>intrinsicContentSize</code> 方法比较类似，都是用来计算 view 的 size 的。笔者曾一度对二者的关系非常疑惑，甚至觉得二者存在相互调用的关系。后来通过验证发现不是这么回事儿，后文会通过示例说明。</p>
<p>对于显示多行文本的UILabel，为了方便 intrinsicContentSize 方法更方便计算 content size，需要指定preferredMaxLayoutWidth 属性值；对于 UITextView 的 sizeThatFits:，似乎有类似的需求，毕竟 UITextView 也可能会显示多行啊，这样说来，UITextView 也有一个 preferredMaxLayoutWidth 属性？</p>
<p>No！preferredMaxLayoutWidth 属性是 iOS 6 才引入的，sizeThatFits: 方法则早得多，况且，UITextView 是可以滚动的，哪怕文本不会全部呈现出来，但也可以通过左右或者上下滚动浏览所有内容；传给 sizeThatFits: 的参数（假设为 size）是 CGSize 类型，size.width 的功能和 UILabel 的 preferredMaxLayoutWidth 差不多，指定了 UITextView 区域的最大宽度，size.height 则指定了 UITextView 区域的最大高度。</p>
<p>值得一提的是，调用 sizeThatFits: 并不改变 view 的 size，它只是让 view 根据已有 content 和给定 size 计算出最合适的 view.size。</p>
<p>那么 <code>sizeToFit</code> 方法是干嘛的呢？很简单：</p>
<blockquote>
<p>calls sizeThatFits: with current view bounds and changes bounds size.</p>
</blockquote>
<p>P.S：有点不太理解，这个「current view」指的是啥？self？还是 superview？ P.P.S：经过验证，这里的「current view」指的是self。简单来说，sizeToFit等价于：</p>
<figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// calls sizeThatFits</span></span><br><span class="line">CGSize <span class="built_in">size</span> = [self sizeThatFits:self.bounds.<span class="built_in">size</span>];</span><br><span class="line"><span class="comment">// change bounds size</span></span><br><span class="line">CGRect bounds = self.bounds;</span><br><span class="line">bounds.<span class="built_in">size</span>.<span class="built_in">width</span> = <span class="built_in">size</span>.<span class="built_in">width</span>;</span><br><span class="line">bounds.<span class="built_in">size</span>.<span class="built_in">height</span> = <span class="built_in">size</span>.<span class="built_in">width</span>;</span><br><span class="line">self.bounds = bounds;</span><br></pre></td></tr></table></figure>

<p>P.S：值得一提的是，经过测试发现，当调用sizeThatFits:的size=(width, height)，当 width/height 的值为 0 时，width/height 似乎就被认为是无穷大！</p>
<h2 id="systemLayoutSizeFittingSize"><a href="#systemLayoutSizeFittingSize" class="headerlink" title="systemLayoutSizeFittingSize:"></a>systemLayoutSizeFittingSize:</h2><p>首先来看一个应用场景。</p>
<p>场景四：某个 UIView，宽度等于屏幕宽度，包含两个 UILabel，两个 label 都可能显示多行文本，要求结合 auto layout 让UIView 大小能够自适应 subviews。</p>
<p>Easy，给出如下代码：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">- (void)viewDidLoad &#123;</span><br><span class="line">    [super viewDidLoad];</span><br><span class="line">    self.view.backgroundColor = [UIColor lightGrayColor];</span><br><span class="line">    </span><br><span class="line">    bgView = (&#123;</span><br><span class="line">        UIView *view         = [[UIView alloc] init];</span><br><span class="line">        view.backgroundColor = [UIColor grayColor];</span><br><span class="line">        view;</span><br><span class="line">    &#125;);</span><br><span class="line">    [self.view addSubview:bgView];</span><br><span class="line">    </span><br><span class="line">    label1 = (&#123;</span><br><span class="line">        UILabel *<span class="keyword">label</span><span class="bash">                = [[UILabel alloc] init];</span></span><br><span class="line">        <span class="keyword">label</span>.<span class="bash">font                    = [UIFont systemFontOfSize:14.0];</span></span><br><span class="line">        <span class="keyword">label</span>.<span class="bash">preferredMaxLayoutWidth = self.view.frame.size.width-20;</span></span><br><span class="line">        <span class="keyword">label</span>.<span class="bash">numberOfLines           = 0;</span></span><br><span class="line">        <span class="keyword">label</span>.<span class="bash">textColor               = [UIColor whiteColor];</span></span><br><span class="line">        <span class="keyword">label</span>.<span class="bash">backgroundColor         = [UIColor purpleColor];</span></span><br><span class="line">        <span class="keyword">label</span><span class="bash">;</span></span><br><span class="line">    &#125;);</span><br><span class="line">    [bgView addSubview:label1];</span><br><span class="line">    </span><br><span class="line">    label2 = (&#123;</span><br><span class="line">        UILabel *<span class="keyword">label</span><span class="bash">                = [[UILabel alloc] init];</span></span><br><span class="line">        <span class="keyword">label</span>.<span class="bash">font                    = [UIFont systemFontOfSize:18.0];</span></span><br><span class="line">        <span class="keyword">label</span>.<span class="bash">preferredMaxLayoutWidth = self.view.frame.size.width-20;</span></span><br><span class="line">        <span class="keyword">label</span>.<span class="bash">numberOfLines           = 0;</span></span><br><span class="line">        <span class="keyword">label</span>.<span class="bash">textColor               = [UIColor whiteColor];</span></span><br><span class="line">        <span class="keyword">label</span>.<span class="bash">backgroundColor         = [UIColor redColor];</span></span><br><span class="line">        <span class="keyword">label</span><span class="bash">;</span></span><br><span class="line">    &#125;);</span><br><span class="line">    [bgView addSubview:label2];</span><br><span class="line">    </span><br><span class="line">    // 添加约束（基于Masonry）</span><br><span class="line">    [bgView mas_makeConstraints:^(MASConstraintMaker *make) &#123;</span><br><span class="line">        make.left.equalTo(self.view.mas_left);</span><br><span class="line">        make.top.equalTo(self.view.mas_top).offset(<span class="number">10</span>);</span><br><span class="line">        make.width.equalTo(self.view.mas_width);</span><br><span class="line">    &#125;];</span><br><span class="line">    </span><br><span class="line">    [label1 mas_makeConstraints:^(MASConstraintMaker *make) &#123;</span><br><span class="line">        make.left.equalTo(bgView.mas_left).offset(<span class="number">10</span>);</span><br><span class="line">        make.right.lessThanOrEqualTo(bgView.mas_right).offset(-<span class="number">10</span>);</span><br><span class="line">        make.top.equalTo(bgView.mas_top).offset(<span class="number">10</span>);</span><br><span class="line">    &#125;];</span><br><span class="line">    </span><br><span class="line">    [label2 mas_makeConstraints:^(MASConstraintMaker *make) &#123;</span><br><span class="line">        make.left.equalTo(label1.mas_left);</span><br><span class="line">        make.right.lessThanOrEqualTo(bgView.mas_right).offset(-<span class="number">10</span>);</span><br><span class="line">        make.top.equalTo(label1.mas_bottom).offset(<span class="number">10</span>);</span><br><span class="line">        make.bottom.equalTo(bgView.mas_bottom).offset(-<span class="number">10</span>);</span><br><span class="line">    &#125;];</span><br><span class="line">    </span><br><span class="line">    label1.text = @<span class="string">"天地玄黄 宇宙洪荒 日月盈昃 辰宿列张 寒来暑往 秋收冬藏 闰余成岁 律吕调阳"</span>;</span><br><span class="line">    label2.text = @<span class="string">"天地玄黄 宇宙洪荒 日月盈昃 辰宿列张 寒来暑往 秋收冬藏 闰余成岁 律吕调阳"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>代码看得有些枯燥，简单来说，bgView（UIView）中嵌入两个能显示多行文本的 label1（UILabel）和 label2（UILabel），设置约束如下：<br><img src="4.png" alt="4"></p>
<p>代码运行后的显示效果：<br><img src="5.png" alt="5"></p>
<p>代码中除了添加各种各样的 constraints，没有任何设置 frame 的代码，显然都是基于 auto layout 的。</p>
<p>那么问题来了，理解 label1 和 label2 的布局没啥子问题，因为它们的 intrinsicContentSize 方法会将 content size 告诉 auto layout system，进而后者会为它们的 size 设置对应值；但对于 bgView，它可是一个 UIView 对象，它的intrinsicContentSize 回调方法的返回值为(-1,-1)，那么 auto layout system 是如何为它设置合适的 size 的呢？</p>
<p>根据我的理解，auto layout system 在处理某个 view 的 size 时，参考值包括：</p>
<ul>
<li>自身的 intrinsicContentSize 方法返回值；</li>
<li>subviews 的intrinsicContentSize方法返回值；</li>
<li>自身和 subviews 的 constraints；</li>
</ul>
<p><img src="6.png" alt=""></p>
<p>OK，根据笔者理解，结合上图，我认为 auto layout system 是这样计算一下 bgView 的 size 的：</p>
<p><code>width=max{10+size1.width+10, 10+size2.width+10, size3.width} height=max{10+size1.height+10+size2.height+10, size3.height}</code></p>
<p>我们在 <code>viewDidAppear:</code> 方法中将相关值打印出来瞧瞧看：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)viewDidAppear:(<span class="built_in">BOOL</span>)animated &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidAppear:animated];</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CGSize</span> size1 = [label1 intrinsicContentSize];</span><br><span class="line">    <span class="built_in">CGSize</span> size2 = [label2 intrinsicContentSize];</span><br><span class="line">    <span class="built_in">CGSize</span> size3 = [bgView intrinsicContentSize];</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"size1 = %@"</span>, <span class="built_in">NSStringFromCGSize</span>(size1));    <span class="comment">// print: "size1 = &#123;300, 33.5&#125;"</span></span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"size2 = %@"</span>, <span class="built_in">NSStringFromCGSize</span>(size2));    <span class="comment">// print: "size2 = &#123;290.5, 64.5&#125;"</span></span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"size3 = %@"</span>, <span class="built_in">NSStringFromCGSize</span>(size3));    <span class="comment">// print: "size3 = &#123;-1, -1&#125;"</span></span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CGSize</span> bgViewSize = bgView.frame.size;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"bgViewSize = %@"</span>, <span class="built_in">NSStringFromCGSize</span>(bgViewSize));  <span class="comment">// print: "bgViewSize = &#123;320, 128&#125;"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>完全吻合我理解的 auto layout size 计算公式。</p>
<p>P.S：然而，我知道，事实往往并没有这么简单，当处理自定义 View 时，当 constraints 设置不完整或者冲突时，事情总会变得复杂起来，也总会得到意想不到的结果。但，暂且就这么理解吧！</p>
<p>啰里啰嗦写了这么多，还没引出 systemLayoutSizeFittingSize: 方法…</p>
<p>OK，再来看另外一个应用场景。</p>
<p>场景五：某个 UIView，宽度等于屏幕宽度，包含一个 UILabel 和一个 UITextView，二者都可能显示多行文本，要求结合 auto layout 让 UIView 大小能够自适应 subviews。</p>
<p>在场景四代码基础上将 label2 改为 UITextView 对象 textView1，如下：</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">- (void)viewDidLoad &#123;</span><br><span class="line">    [super viewDidLoad];</span><br><span class="line">    self.view.backgroundColor = [UIColor lightGrayColor];</span><br><span class="line">    </span><br><span class="line">    bgView = (&#123;</span><br><span class="line">        UIView *view         = [[UIView alloc] init];</span><br><span class="line">        view.backgroundColor = [UIColor grayColor];</span><br><span class="line">        view;</span><br><span class="line">    &#125;);</span><br><span class="line">    [self.view addSubview:bgView];</span><br><span class="line">    </span><br><span class="line">    label1 = (&#123;</span><br><span class="line">        UILabel *<span class="keyword">label</span><span class="bash">                = [[UILabel alloc] init];</span></span><br><span class="line">        <span class="keyword">label</span>.<span class="bash">font                    = [UIFont systemFontOfSize:14.0];</span></span><br><span class="line">        <span class="keyword">label</span>.<span class="bash">preferredMaxLayoutWidth = self.view.frame.size.width-20;</span></span><br><span class="line">        <span class="keyword">label</span>.<span class="bash">numberOfLines           = 0;</span></span><br><span class="line">        <span class="keyword">label</span>.<span class="bash">textColor               = [UIColor whiteColor];</span></span><br><span class="line">        <span class="keyword">label</span>.<span class="bash">backgroundColor         = [UIColor purpleColor];</span></span><br><span class="line">        <span class="keyword">label</span><span class="bash">;</span></span><br><span class="line">    &#125;);</span><br><span class="line">    [bgView addSubview:label1];</span><br><span class="line">    </span><br><span class="line">    textView1 = (&#123;</span><br><span class="line">        UITextView *<span class="keyword">label</span><span class="bash">     = [[UITextView alloc] init];</span></span><br><span class="line">        <span class="keyword">label</span>.<span class="bash">font            = [UIFont systemFontOfSize:18.0];</span></span><br><span class="line">        <span class="keyword">label</span>.<span class="bash">textColor       = [UIColor whiteColor];</span></span><br><span class="line">        <span class="keyword">label</span>.<span class="bash">backgroundColor = [UIColor redColor];</span></span><br><span class="line">        <span class="keyword">label</span><span class="bash">;</span></span><br><span class="line">    &#125;);</span><br><span class="line">    [bgView addSubview:textView1];</span><br><span class="line">    </span><br><span class="line">    // 添加约束（基于Masonry）</span><br><span class="line">    [bgView mas_makeConstraints:^(MASConstraintMaker *make) &#123;</span><br><span class="line">        make.left.equalTo(self.view.mas_left);</span><br><span class="line">        make.top.equalTo(self.view.mas_top).offset(<span class="number">10</span>);</span><br><span class="line">        make.width.equalTo(self.view.mas_width);</span><br><span class="line">    &#125;];</span><br><span class="line">    </span><br><span class="line">    [label1 mas_makeConstraints:^(MASConstraintMaker *make) &#123;</span><br><span class="line">        make.left.equalTo(bgView.mas_left).offset(<span class="number">10</span>);</span><br><span class="line">        make.right.lessThanOrEqualTo(bgView.mas_right).offset(-<span class="number">10</span>);</span><br><span class="line">        make.top.equalTo(bgView.mas_top).offset(<span class="number">10</span>);</span><br><span class="line">    &#125;];</span><br><span class="line">    </span><br><span class="line">    [textView1 mas_makeConstraints:^(MASConstraintMaker *make) &#123;</span><br><span class="line">        make.left.equalTo(label1.mas_left);</span><br><span class="line">        make.right.lessThanOrEqualTo(bgView.mas_right).offset(-<span class="number">10</span>);</span><br><span class="line">        make.top.equalTo(label1.mas_bottom).offset(<span class="number">10</span>);</span><br><span class="line">        make.bottom.equalTo(bgView.mas_bottom).offset(-<span class="number">10</span>);</span><br><span class="line">    &#125;];</span><br><span class="line">    </span><br><span class="line">    label1.text = @<span class="string">"天地玄黄 宇宙洪荒 日月盈昃 辰宿列张 寒来暑往 秋收冬藏 闰余成岁 律吕调阳"</span>;</span><br><span class="line">    textView1.text = @<span class="string">"天地玄黄 宇宙洪荒 日月盈昃 辰宿列张 寒来暑往 秋收冬藏 闰余成岁 律吕调阳"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行效果如下：<br><img src="7.png" alt=""></p>
<p>这显然不是我们想要的结果，至少存在这么两个问题：</p>
<ol>
<li>textView1 不见了；</li>
<li>bgView 的大小不是我们想要的；</li>
</ol>
<p>为什么会有出现这样的问题呢？</p>
<p>首先正如上文所提到的那样，textView1 是 UITextView 的对象，而 UITextView 是 UIScrollView 的子类，它的intrinsicContentSize:方法的返回值是(-1,-1)，这意味着 textView1 对 bgView 的 auto layout size 没有产生影响。</p>
<p>那 textView1 为什么不见了呢？或者说，为什么 textView1 的 size 为 CGSizeZero 呢？根据我对 auto layout system 的理解，auto layout system 在处理 view 的 size 时，受三个因素影响：</p>
<ul>
<li>自身的intrinsicContentSize方法返回值；</li>
<li>subviews 的intrinsicContentSize方法返回值；</li>
<li>自身和 subviews 的 constraints；</li>
</ul>
<p>对于 textView1，前两个因素可以忽略掉，简而言之，textView1 的 size 由它自身的 constraints 决定。而根据上述代码的约束可以计算出 textView1 的 height： height = bgView.height-10-label1.height-10-10;</p>
<p>而 bgView.height=10+label1.height+10+10；意味着 textView1 的 height 值为 0；当然就看不到了 textView1 了。</p>
<p>因此，若想要让 textView1 正常可见，至少有这么一种策略：直接为 textView1 添加约束设置 width 和 height；</p>
<p>简单来说，override 回调方法viewWillLayoutSubviews，如下：</p>
<figure class="highlight roboconf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">- (void)viewWillLayoutSubviews &#123;</span><br><span class="line">    [<span class="attribute">super viewWillLayoutSubviews];</span></span><br><span class="line"><span class="attribute"></span></span><br><span class="line"><span class="attribute">    CGSize textViewFitSize = [textView1 sizeThatFits</span>:CGSizeMake(self<span class="variable">.view</span><span class="variable">.frame</span><span class="variable">.size</span><span class="variable">.width-</span>20, 0)];</span><br><span class="line">    [<span class="attribute">textView1 mas_updateConstraints</span>:^(MASConstraintMaker *make) &#123;</span><br><span class="line">        make<span class="variable">.width</span><span class="variable">.equalTo</span>([NSNumber numberWithFloat:textViewFitSize<span class="variable">.width</span>]);</span><br><span class="line">        <span class="attribute">make.height.equalTo([NSNumber numberWithFloat</span>:textViewFitSize<span class="variable">.height</span>]);</span><br><span class="line">    &#125;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这种做法是有效的，运行效果如下：<br><img src="8.png" alt=""></p>
<p>若将这种场景切换到 table view cell 中会如何呢？简单来说，如果将上述的 bgView 换成 UITableViewCell（或其子类）对象又会如何呢？</p>
<p>在 table view 中，我们可以使用- (CGFloat)tableView:heightForRowAtIndexPath:接口，该回调方法会返回 CGFloat 值，该值指示了对应 cell 的高度；假设 auto layout system 为 cell 分配的 size 是 autoSize，在处理返回值时额外加上 textViewFitSize.height 即可。</p>
<p>但问题是，我们如何获取这个 autoSize 的值呢？毕竟此时 cell 还未布局完成啊，直接读取 cell.frame.size 肯定是不行的。</p>
<p><code>systemLayoutSizeFittingSize:</code> 方法正是用于处理这个问题的。</p>
<p>UIView Class References对该方法描述如下：</p>
<blockquote>
<p>Returns the size of the view that satisfies the constraints it holds.   Return Value The size of the view that satisfies the constraints it holds.   Discussion Determines the best size of the view considering all constraints it holds and those of its subviews.</p>
</blockquote>
<p>我是这么理解 systemLayoutSizeFittingSize: 的：对于使用 auto layout 机制布局的 view，auto layout system 会在布局过程中综合各种约束的考虑为之设置一个 size，在布局完成后，该 size 的值即为 view.frame.size 的值；这包含的另外一层意思，即在布局完成前，我们是不能通过 view.frame.size 准确获取 view 的 size 的。但有时候，我们需要在 auto layout system 对 view 完成布局前就知道它的 size，systemLayoutSizeFittingSize: 方法正是能够满足这种要求的 API。systemLayoutSizeFittingSize: 方法会根据其 constraints 返回一个合适的 size 值。</p>
<p><code>systemLayoutSizeFittingSize:</code> 方法可传入一个参数，目前有两个值可以传入：</p>
<ul>
<li>UILayoutFittingCompressedSize : The option to use the smallest possible size.</li>
<li>UILayoutFittingExpandedSize : The option to use the largest possible size.</li>
</ul>
<p>值得一提的是，在使用 <code>[view systemLayoutSizeFittingSize:]</code> 时，要注意尽量确保 view 的 constraints 的完整性，这样参数 UILayoutFittingCompressedSize 和 UILayoutFittingExpandedSize 得到的结果是一样的。否则，举个例子，若 view 的 right 属性没有设置，则这两个参数得到systemLayoutSizeFittingSize:返回值 size 是不一样的，前者 size.width=0，后者 size.width=1000。</p>
<p>至于 systemLayoutSizeFittingSize: 的使用场景，动态计算 UITableViewCell 高度详解非常值得参考！</p>
<h2 id="对比几种-API"><a href="#对比几种-API" class="headerlink" title="对比几种 API"></a>对比几种 API</h2><p>在刚开始接触这几个 API 时感到非常困惑。分不清 intrinsicContentSize、sizeThatFits: 以及systemLayoutSizeFittingSize: 的区别。经过这么将近一天的折腾，现在大概有了基本的判断。</p>
<p>首先说 intrinsicContentSize，它的最主要作用是告诉 auto layout system 一些信息，可以认为它是后者的回调方法，auto layout system 在对 view 进行布局时会参考这个回调方法的返回值；一般很少像CGSize size = [view intrinsicContentSize]去使用intrinsicContentSize API。</p>
<p>再来看 sizeThatFits: 和 systemLayoutSizeFittingSize:，它们俩非常相似，都是为开发者直接服务的 API（而不是回调方法）。所不同的是，<strong>sizeThatFits:是 auto layout 之前就存在的</strong>，一般在 leaf-level views 中用得比较多，在计算 size 过程中，它可不会考虑 constraints 神马的；对于systemLayoutSizeFittingSize:，它是随着 auto layout（iOS 6）引入的，用于在 view 完成布局前获取 size 值，如果 view 的 constraints 确保了完整性和正确性，通常它的返回值就是 view 完成布局之后的 view.frame.size 的值。</p>
<p>它们之前存在相互调用的关系吗？经过测试发现，三者之前没有直接的调用关系。但是能得出这样的结论：<code>intrinsicContentSize</code> 的返回值会直接影响 <code>systemLayoutSizeFittingSize:</code> 的返回值。至于底层是如何处理的不得而知。</p>

            
        </section>
        <footer class="blog-post-page-tags">
        
			
				
			<a href="/web/tags/iOS-Frame/" rel="tag" data-toggle="tooltip" data-placement="top" title="Linux">iOS Frame</a>
				
			<a href="/web/tags/iOS-Autolayout/" rel="tag" data-toggle="tooltip" data-placement="top" title="Linux">iOS Autolayout</a>
				
			
		
        </footer>
    </article>
    <article class="blog-post-page-readmore">
    	
    	
		

		
		
			<a href="/web/2021/03/09/iOS-%E5%BC%80%E5%8F%91%E8%A7%84%E8%8C%83/" class="blog-post-page-readmore-next" data-toggle="tooltip" data-placement="top" title="iOS 开发规范">下一篇</a>
		

        <div style="clear: both;"></div>
    </article>

    <article class="blog-post-block blog-post-page-content">
            <div class="row">
            
                <div class="col-md-4 col-sm-4 post-page-more-btn">
                    <span  data-toggle="modal" data-target="#post-donate-content">
                        <span id="post-donate-btn" class="btn btn-danger btn-block" data-toggle="tooltip" data-placement="top" title="如果您觉得本文还不错或者对您有帮助，可以考虑打赏一下作者哦">打赏本文</span>
                    </span>
                </div>
                <div class="col-md-4 col-sm-4 post-page-more-btn">
                    <span  data-toggle="modal" data-target="#post-qrcode-content">
                        <span><span id="post-qrcode-btn" class="btn btn-success btn-block" data-toggle="tooltip" data-placement="top" title="微信扫描二维码手机端查看本文及分享本文">二维码</span></span>
                    </span>
                </div>
            </div>
        <div class="post-more-function-br"></div>

        <div class="modal fade" id="post-donate-content" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">打赏本文</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="row post-donate-content">
                            <div class="col-md-4">
                                <p>支付宝</p>
                                <img class="post-donate-content-img no-lightbox" src="https://wordpress.obs.cn-north-1.myhuaweicloud.com/money-qr/alipay.jpg"/>
                            </div>
                            <div class="col-md-4">
                                <p>微信</p>
                                <img class="post-donate-content-img no-lightbox" src="https://wordpress.obs.cn-north-1.myhuaweicloud.com/money-qr/wechat.png"/>
                            </div>
                            <div class="col-md-4">
                                <p>财付通</p>
                                <img class="post-donate-content-img no-lightbox" src="https://wordpress.obs.cn-north-1.myhuaweicloud.com/money-qr/qqpay.png"/>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="post-qrcode-content" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-sm" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="exampleModalLabel">文章二维码</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="row post-qrcode-content">
                            <span class="post-qrcode-content-canvas"></span>
                            <img class="post-qrcode-content-img no-lightbox" src=""/>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>
                    </div>
                </div>
            </div>
        </div>
        
        <script>
            // post QRcode
            // 中文转码
            function toUtf8(str) {
                var out, i, len, c;
                out = "";
                len = str.length;
                for (i = 0; i < len; i++) {
                    c = str.charCodeAt(i);
                    if ((c >= 0x0001) && (c <= 0x007F)) {
                        out += str.charAt(i);
                    } else if (c > 0x07FF) {
                        out += String.fromCharCode(0xE0 | ((c >> 12) & 0x0F));
                        out += String.fromCharCode(0x80 | ((c >> 6) & 0x3F));
                        out += String.fromCharCode(0x80 | ((c >> 0) & 0x3F));
                    } else {
                        out += String.fromCharCode(0xC0 | ((c >> 6) & 0x1F));
                        out += String.fromCharCode(0x80 | ((c >> 0) & 0x3F));
                    }
                }
                return out;
            }
            // 生成
            var qrcode= $('.post-qrcode-content-canvas').qrcode({width: 150,height: 150,text: toUtf8("https://joriwang.github.io/web/2021/05/18/iOS-%E5%B8%83%E5%B1%80-%E5%B0%BA%E5%AF%B8%E8%AE%A1%E7%AE%97/")}).hide();
            var canvas=qrcode.find('canvas').get(0);
            $('.post-qrcode-content-img').attr('src',canvas.toDataURL('image/jpg'));
        </script>

        
    </article>
    
</div>

                
            <footer class="blog-footer">
                <p class="blog-footer-left">Copyright ©  2021 <a href="https://joriwang.github.io/web">Hello Skill</a></p>
                <p class="blog-footer-right">Powered by <a href="https://hexo.io" target="_blank">Hexo</a>,Theme <a href="https://note.isweic.com/themes-life/" target="_blank">Life</a></p>
            </footer>
        </div><!--博客主栏结束-->
        <!--博客侧边栏开始-->
        <div class="col-xl-3 blog-sidebar">
            <div class="blog-sidebar-title">
                <a href="">Hello Skill</a>
            </div>
            <div class="blog-sidebar-logo">
                <img src="http://dl.weic96.cn/logo.png">
            </div>
            <div class="blog-sidebar-count blog-sidebar-padding">
                <div class="blog-sidebar-count-left">
                    <p class="blog-sidebar-count-p">40</p>
                    <span class="blog-sidebar-count-span">文章</span>
                </div>
                <div class="blog-sidebar-count-right">
                    <p class="blog-sidebar-count-p">43</p>
                    <span class="blog-sidebar-count-span">标签</span>
                </div>
                <div style="clear: both;"></div>
            </div>
            <div class="blog-sidebar-icon blog-sidebar-padding">
                <ul>
                    <li><a href="https://github.com/joriwang/" class="icon-github" target="_blank" data-toggle="tooltip" data-placement="top" title="Github"><i class="fa fa-github"></i></a></li>
                    <li><a href="" class="icon-weibo" target="_blank" data-toggle="tooltip" data-placement="top" title="新浪微博"><i class="fa fa-weibo"></i></a></li>
                    <li><a href="" class="icon-twitter" target="_blank" data-toggle="tooltip" data-placement="top" title="Twitter"><i class="fa fa-twitter"></i></a></li>
                    <!--<li><a href="" class="icon-facebook" target="_blank" data-toggle="tooltip" data-placement="top" title="FaceBook"><i class="fa fa-facebook"></i></a></li>-->
                    <li><a href="mailto:463398425@qq.com" class="icon-email" data-toggle="tooltip" data-placement="top" title="E-Mail"><i class="fa fa-envelope"></i></a></li>
                    <li><a href="" class="icon-rss" data-toggle="tooltip" target="_blank" data-placement="top" title="RSS"><i class="fa fa-rss"></i></a></li>
                </ul>
            </div>
            <div class="blog-sidebar-categories">
                <h4 class="blog-sidebar-h4"><i class="fa fa-folder-open"></i>&nbsp;文章分类</h4>
                <ul class="list-group blog-sidebar-padding">
                  
                    
                      <li class="list-group-item justify-content-between">
                          <a href="/web/categories/Android/">Android</a>
                          <span class="badge badge-default badge-pill">4</span>
                      </li>
                    
                      <li class="list-group-item justify-content-between">
                          <a href="/web/categories/iOS/">iOS</a>
                          <span class="badge badge-default badge-pill">20</span>
                      </li>
                    
                      <li class="list-group-item justify-content-between">
                          <a href="/web/categories/git/">git</a>
                          <span class="badge badge-default badge-pill">2</span>
                      </li>
                    
                      <li class="list-group-item justify-content-between">
                          <a href="/web/categories/GitHub/">GitHub</a>
                          <span class="badge badge-default badge-pill">1</span>
                      </li>
                    
                      <li class="list-group-item justify-content-between">
                          <a href="/web/categories/%E5%B9%B3%E5%8F%B0%E5%B7%A5%E5%85%B7/">平台工具</a>
                          <span class="badge badge-default badge-pill">2</span>
                      </li>
                    
                      <li class="list-group-item justify-content-between">
                          <a href="/web/categories/SQLite/">SQLite</a>
                          <span class="badge badge-default badge-pill">1</span>
                      </li>
                    
                      <li class="list-group-item justify-content-between">
                          <a href="/web/categories/iOS/SwiftUI/">SwiftUI</a>
                          <span class="badge badge-default badge-pill">2</span>
                      </li>
                    
                      <li class="list-group-item justify-content-between">
                          <a href="/web/categories/xcode/">xcode</a>
                          <span class="badge badge-default badge-pill">1</span>
                      </li>
                    
                      <li class="list-group-item justify-content-between">
                          <a href="/web/categories/%E5%BC%80%E5%8F%91%E8%A7%84%E8%8C%83/">开发规范</a>
                          <span class="badge badge-default badge-pill">1</span>
                      </li>
                    
                      <li class="list-group-item justify-content-between">
                          <a href="/web/categories/itms/">itms</a>
                          <span class="badge badge-default badge-pill">2</span>
                      </li>
                    
                      <li class="list-group-item justify-content-between">
                          <a href="/web/categories/%E4%BA%A7%E5%93%81/">产品</a>
                          <span class="badge badge-default badge-pill">1</span>
                      </li>
                    
                      <li class="list-group-item justify-content-between">
                          <a href="/web/categories/iOS/Android/">Android</a>
                          <span class="badge badge-default badge-pill">1</span>
                      </li>
                    
                      <li class="list-group-item justify-content-between">
                          <a href="/web/categories/%E6%95%B0%E5%AD%A6/">数学</a>
                          <span class="badge badge-default badge-pill">1</span>
                      </li>
                    
                      <li class="list-group-item justify-content-between">
                          <a href="/web/categories/%E9%9F%B3%E8%A7%86%E9%A2%91/">音视频</a>
                          <span class="badge badge-default badge-pill">1</span>
                      </li>
                    
                      <li class="list-group-item justify-content-between">
                          <a href="/web/categories/%E8%BF%90%E8%90%A5/">运营</a>
                          <span class="badge badge-default badge-pill">2</span>
                      </li>
                    
                      <li class="list-group-item justify-content-between">
                          <a href="/web/categories/%E6%95%B0%E5%AD%A6/%E7%BA%BF%E6%80%A7%E4%BB%A3%E6%95%B0/">线性代数</a>
                          <span class="badge badge-default badge-pill">1</span>
                      </li>
                    
                      <li class="list-group-item justify-content-between">
                          <a href="/web/categories/iOS/%E9%9F%B3%E8%A7%86%E9%A2%91/">音视频</a>
                          <span class="badge badge-default badge-pill">1</span>
                      </li>
                    
                  
                </ul>
            </div>
            <div class="blog-sidebar-tags">
                <h4 class="blog-sidebar-h4"><i class="fa fa-tag"></i>&nbsp;标签云</h4>
                <ul class="blog-sidebar-tags-ul blog-sidebar-padding">
                  
                    
                      <li><a href="/web/tags/%E7%B1%BB%E5%86%B2%E7%AA%81/" class="tag-could" data-toggle="tooltip" data-placement="top" title="类冲突">类冲突</a></li>
                    
                      <li><a href="/web/tags/Android-%E5%83%8F%E7%B4%A0%E5%AF%86%E5%BA%A6/" class="tag-could" data-toggle="tooltip" data-placement="top" title="Android 像素密度">Android 像素密度</a></li>
                    
                      <li><a href="/web/tags/%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/" class="tag-could" data-toggle="tooltip" data-placement="top" title="生命周期">生命周期</a></li>
                    
                      <li><a href="/web/tags/Android/" class="tag-could" data-toggle="tooltip" data-placement="top" title="Android">Android</a></li>
                    
                      <li><a href="/web/tags/APK/" class="tag-could" data-toggle="tooltip" data-placement="top" title="APK">APK</a></li>
                    
                      <li><a href="/web/tags/cocoapods/" class="tag-could" data-toggle="tooltip" data-placement="top" title="cocoapods">cocoapods</a></li>
                    
                      <li><a href="/web/tags/Linun-%E5%91%BD%E4%BB%A4/" class="tag-could" data-toggle="tooltip" data-placement="top" title="Linun 命令">Linun 命令</a></li>
                    
                      <li><a href="/web/tags/C-OC-%E8%BE%93%E5%87%BA%E5%8D%A0%E4%BD%8D%E7%AC%A6/" class="tag-could" data-toggle="tooltip" data-placement="top" title="C/OC 输出占位符">C/OC 输出占位符</a></li>
                    
                      <li><a href="/web/tags/SQLite/" class="tag-could" data-toggle="tooltip" data-placement="top" title="SQLite">SQLite</a></li>
                    
                      <li><a href="/web/tags/Swift/" class="tag-could" data-toggle="tooltip" data-placement="top" title="Swift">Swift</a></li>
                    
                      <li><a href="/web/tags/SwiftUI/" class="tag-could" data-toggle="tooltip" data-placement="top" title="SwiftUI">SwiftUI</a></li>
                    
                      <li><a href="/web/tags/%E4%BF%AE%E9%A5%B0%E5%99%A8/" class="tag-could" data-toggle="tooltip" data-placement="top" title="修饰器">修饰器</a></li>
                    
                      <li><a href="/web/tags/xcode/" class="tag-could" data-toggle="tooltip" data-placement="top" title="xcode">xcode</a></li>
                    
                      <li><a href="/web/tags/iMessage/" class="tag-could" data-toggle="tooltip" data-placement="top" title="iMessage">iMessage</a></li>
                    
                      <li><a href="/web/tags/iOS14-Widget/" class="tag-could" data-toggle="tooltip" data-placement="top" title="iOS14 Widget">iOS14 Widget</a></li>
                    
                      <li><a href="/web/tags/iOS/" class="tag-could" data-toggle="tooltip" data-placement="top" title="iOS">iOS</a></li>
                    
                      <li><a href="/web/tags/itms/" class="tag-could" data-toggle="tooltip" data-placement="top" title="itms">itms</a></li>
                    
                      <li><a href="/web/tags/OC/" class="tag-could" data-toggle="tooltip" data-placement="top" title="OC">OC</a></li>
                    
                      <li><a href="/web/tags/%E9%94%81%E5%B1%8F%E5%BC%80%E7%81%AF%E5%8A%A8%E6%95%88/" class="tag-could" data-toggle="tooltip" data-placement="top" title="锁屏开灯动效">锁屏开灯动效</a></li>
                    
                      <li><a href="/web/tags/iOS-%E7%BE%8E%E5%8C%96/" class="tag-could" data-toggle="tooltip" data-placement="top" title="iOS 美化">iOS 美化</a></li>
                    
                      <li><a href="/web/tags/%E5%8E%9F%E5%9E%8B/" class="tag-could" data-toggle="tooltip" data-placement="top" title="原型">原型</a></li>
                    
                      <li><a href="/web/tags/%E5%BC%80%E5%8F%91%E5%B7%A5%E5%85%B7/" class="tag-could" data-toggle="tooltip" data-placement="top" title="开发工具">开发工具</a></li>
                    
                      <li><a href="/web/tags/APP%E5%BC%80%E5%8F%91%E5%A4%A7%E8%87%B4%E6%B5%81%E7%A8%8B/" class="tag-could" data-toggle="tooltip" data-placement="top" title="APP开发大致流程">APP开发大致流程</a></li>
                    
                      <li><a href="/web/tags/UI-%E5%BF%85%E5%A4%87%E5%9F%BA%E7%A1%80%E6%8A%80%E8%83%BD/" class="tag-could" data-toggle="tooltip" data-placement="top" title="UI 必备基础技能">UI 必备基础技能</a></li>
                    
                      <li><a href="/web/tags/%E7%BA%BF%E6%80%A7%E4%BB%A3%E6%95%B0/" class="tag-could" data-toggle="tooltip" data-placement="top" title="线性代数">线性代数</a></li>
                    
                      <li><a href="/web/tags/%E8%A7%86%E9%A2%91%E7%9B%B8%E5%85%B3%E6%A6%82%E5%BF%B5/" class="tag-could" data-toggle="tooltip" data-placement="top" title="视频相关概念">视频相关概念</a></li>
                    
                      <li><a href="/web/tags/FFmpeg/" class="tag-could" data-toggle="tooltip" data-placement="top" title="FFmpeg">FFmpeg</a></li>
                    
                      <li><a href="/web/tags/LTV/" class="tag-could" data-toggle="tooltip" data-placement="top" title="LTV">LTV</a></li>
                    
                      <li><a href="/web/tags/CAC/" class="tag-could" data-toggle="tooltip" data-placement="top" title="CAC">CAC</a></li>
                    
                      <li><a href="/web/tags/%E9%A9%AC%E7%94%B2%E5%8C%85/" class="tag-could" data-toggle="tooltip" data-placement="top" title="马甲包">马甲包</a></li>
                    
                      <li><a href="/web/tags/LivePhoto/" class="tag-could" data-toggle="tooltip" data-placement="top" title="LivePhoto">LivePhoto</a></li>
                    
                      <li><a href="/web/tags/Universal-Link/" class="tag-could" data-toggle="tooltip" data-placement="top" title="Universal Link">Universal Link</a></li>
                    
                      <li><a href="/web/tags/Deep-Link/" class="tag-could" data-toggle="tooltip" data-placement="top" title="Deep Link">Deep Link</a></li>
                    
                      <li><a href="/web/tags/APNS/" class="tag-could" data-toggle="tooltip" data-placement="top" title="APNS">APNS</a></li>
                    
                      <li><a href="/web/tags/%E6%B5%81%E9%87%8F/" class="tag-could" data-toggle="tooltip" data-placement="top" title="流量">流量</a></li>
                    
                      <li><a href="/web/tags/WebClip/" class="tag-could" data-toggle="tooltip" data-placement="top" title="WebClip">WebClip</a></li>
                    
                      <li><a href="/web/tags/Data-%E5%8D%8F%E8%AE%AE/" class="tag-could" data-toggle="tooltip" data-placement="top" title="Data 协议">Data 协议</a></li>
                    
                      <li><a href="/web/tags/base64/" class="tag-could" data-toggle="tooltip" data-placement="top" title="base64">base64</a></li>
                    
                      <li><a href="/web/tags/AutoLayout/" class="tag-could" data-toggle="tooltip" data-placement="top" title="AutoLayout">AutoLayout</a></li>
                    
                      <li><a href="/web/tags/LayoutGuide/" class="tag-could" data-toggle="tooltip" data-placement="top" title="LayoutGuide">LayoutGuide</a></li>
                    
                      <li><a href="/web/tags/SafeArea/" class="tag-could" data-toggle="tooltip" data-placement="top" title="SafeArea">SafeArea</a></li>
                    
                      <li><a href="/web/tags/iOS-Frame/" class="tag-could" data-toggle="tooltip" data-placement="top" title="iOS Frame">iOS Frame</a></li>
                    
                      <li><a href="/web/tags/iOS-Autolayout/" class="tag-could" data-toggle="tooltip" data-placement="top" title="iOS Autolayout">iOS Autolayout</a></li>
                    
                  
                </ul>
            </div>
            <script>
              // 博客侧栏标签云随机色
              var tag_cloud = $('.tag-could');
              tag_cloud.each(function () {
                  var Cnum = 9;
                  var Crand = parseInt(Math.random() * Cnum);
                  $(this).addClass("tag-could" + Crand);
              })
            </script>
            <!--返回顶部按钮-->
            <div class="retop">
                <i class="fa fa-angle-up"></i>
            </div>
        </div><!--博客侧边栏结束-->
    </div>
</div>
<script src="/web/js/LeanStatistics.min.js"></script>
<script src="/web/js/Life.js"></script>
<script type="text/javascript">
    hljs.initHighlightingOnLoad();
    hljs.initLineNumbersOnLoad();
    otherF();
    LeanStatistics();
    $(document).pjax('a', '#pjax-box', {fragment:'#pjax-box', timeout:8000}).on('pjax:complete', function() {
      $('pre code').each(function(i, block){
        hljs.highlightBlock(block);
      })
      $('code.hljs').each(function(i, block) {
        hljs.lineNumbersBlock(block);
      });
      LeanStatistics();
    }).on('pjax:start', function() { NProgress.start(); }).on('pjax:end',   function() {
      NProgress.done();
      otherF();
    });
</script>
</body>
</html>
